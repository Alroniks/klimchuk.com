---
title: 'MODX разработка с Vagrant'
anchor: 'MODX разработка с Vagrant, особенности окружения'
keywords: modx, vagrant, cmp, разработка modx, modx + vagrant, cmp modx vagrant
date: Apr 10, 2014
layout: 'blogpost'
tags:
    - modx
    - development
---

Последние дни в свободное время я занимался тем, что дописывал когда-то начатый проект - Драйвер Яндекс.Диск для MODX Revolution.

О том, как разрабатывался компонент, будет отдельная заметка, а в этой опишу общий подход к разработке дополнений MODX c использованием Vagrant.

> Vagrant (англ. бродяга) — это обёртка для удобного управления виртуальной машиной. Он работает с собственными образами (*.box), для которых предъявляются определённые требования. 

Удобство вагранта в том, что он предоставляет уже настроенное окружение, полностью готовое для работы. Либо вы можете создать и настроить свой образ, который потом можно будет использовать в работе, как это [сделал Василий Наумкин](http://bezumkin.ru/sections/hosting/2317/). Я воспользовался его образом, настроенным для работы с MODX, с некоторыми оптимизациями. Так же я настраивал его для работы над проектом modx.by, но различия минимальны.

Разберемся, как подружить Vagrant и MODX.

<!-- cut -->

### Установка Vagrant и настройка образа

Для начала нужно скачать и установить [VirtualBox](https://www.virtualbox.org/wiki/Downloads) и сам [Vagrant](http://www.vagrantup.com/downloads.html).

Затем нужно скачать уже [преднастроенный для MODX образ](http://yadi.sk/d/hd7MfwC6EHhUp) или использовать другие образы, если у вас другая задача.

Как работать с Vagrant можно ознакомиться или в заметке Василия или в [официальной документации](http://docs.vagrantup.com/v2/)

После того, как скачали образ, нужно его установить. Заходим в папку со скачанным образом и выполняем команду:
	
	vagrant box add modx precise32.box

Теперь создадим новый проект и папку для него, например modx.by, и проинициализируем vagrant.

	vagrant init modx

Vagrant импортировал образ и создал файл с настройками __Vagrantfile__, который лежит в папке нашего проекта - modx.by. Там много всего, но нам это не нужно. Удалив все лишнее у меня остался вот такой вот конфиг:

``` ruby
# -*- mode: ruby -*-
# vi: set ft=ruby :

VAGRANTFILE_API_VERSION = "2"

Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
	config.vm.box = "modx"

	config.vm.network :forwarded_port, guest: 80, host: 8090
	config.vm.synced_folder "www", "/var/www/by/modx/www", :owner => 'vagrant', :group => 'vagrant'

	config.vm.provider :virtualbox do |vb|
    	vb.gui = false
    	vb.customize ["modifyvm", :id, "--memory", "384"]
  	end
end
```

Как видим, ничего сложного, кроме строки с указанием, какие папки монтировать.

`config.vm.synced_folder "www", "/var/www/by/modx/www", :owner => 'vagrant', :group => 'vagrant'` - тут мы говорим виртуальной машине связать папку www внутри папки modx.by с папкой /var/www/by/modx/www внутри виртуальной машины и работать с ней с указанными правами. На Mac пришлось прописать права явно, так как иногда создавались битые файлы и папки.

Запускаем нашу виртуальную машину

	vagrant up

И заходим на нее по ssh

	vagrant ssh

### Установка и настройка MODX

Василий дружелюбно предоставил в образе скрипты автоматической установки MODX, но они не подошли мне, так как требуют создания нового пользователя, а мне нужно работать над одним сайтом от пользователя vagrant. Поэтому настроить хост придется вручную или подправить скрипты установки. У меня пока руки не дошли. 

Мои конфиги для php-fpm и nginx:
```

```

дописать об установке modx

### Создаем компонент

Теперь перейдем к тому, как писать свой компонент. О том, как его писать, я рассказывать не буду, материалов достаточно, опишу лишь то, как настроить vagrant так, чтобы это не было головной болью.

Для начала разберемся, из чего состоят компоненты. Как правило на GitHub можно увидеть 3 папки:
- _build // папка, где лежат скрипты, необходимые для сборки пакета
- core/components/COMPONENT_NAME // папка, где лежат файлы ядра компонента, как правило модели, php-классы и тд.
- assets/component/COMPONENT_NAME // папка, где лежат вспомогательные файлы компонента, как правило различные стили, скрипты, изображения

Подробнее об устройстве пакетов можно почитать в [официальной документации](#).

Для хранения код на GitHub нужно, чтобы все папки и файлы были вместе, но в MODX так повелось, что core и assets лежат в абсолютно разных местах в системе, но на помощь как раз приходит Vagrant. 

В нашей основной операционной система все файлы и папки будут лежать вместе, а с помощью правил монтирования в виртуальной машине эти папки будут лежать там, где и должны.

Создадим рядом с папкой www папку pkg, где будем держать наши компоненты.


